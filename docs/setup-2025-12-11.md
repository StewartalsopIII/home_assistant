# Home Assistant + ESPHome Docker Setup

Date: 2025-12-11

## Purpose

Set up Home Assistant and ESPHome as Docker containers on the Raspberry Pi 5 to enable the ReSpeaker XVF3800 + ESP32S3 board to work as a voice satellite. The end goal is to route audio from the ReSpeaker through Home Assistant to VAPI for an Alexa-style voice agent.

## Why This Approach

Previous attempts to get audio from the ReSpeaker board via direct I2S communication failed (saturated noise instead of real audio). The two chips on the board (XVF3800 audio processor and ESP32S3) weren't communicating properly.

ESPHome has a proven, community-tested integration for this exact board that handles all the I2S/timing complexity. Using Home Assistant + ESPHome is the path of least resistance.

## What Was Installed

### Home Assistant Container
- **Image**: `ghcr.io/home-assistant/home-assistant:stable`
- **Port**: 8123 (web interface)
- **Config location**: `/home/stewartalsop/prototypes/home-assistant/config/`

### ESPHome Container
- **Image**: `ghcr.io/esphome/esphome`
- **Port**: 6052 (web dashboard)
- **Config location**: `/home/stewartalsop/prototypes/home-assistant/esphome/`

## Access URLs

- **Home Assistant**: http://192.168.2.65:8123
- **ESPHome Dashboard**: http://192.168.2.65:6052

## Directory Structure

```
/home/stewartalsop/prototypes/home-assistant/
├── docker-compose.yml    # Container definitions
├── config/               # Home Assistant configuration (auto-generated)
├── esphome/              # ESPHome device configurations
└── docs/                 # This documentation
    └── setup-2025-12-11.md
```

## Docker Compose Configuration

File: `/home/stewartalsop/prototypes/home-assistant/docker-compose.yml`

```yaml
services:
  homeassistant:
    container_name: homeassistant
    image: ghcr.io/home-assistant/home-assistant:stable
    volumes:
      - ./config:/config
      - /etc/localtime:/etc/localtime:ro
      - /run/dbus:/run/dbus:ro
    restart: unless-stopped
    privileged: true
    network_mode: host

  esphome:
    container_name: esphome
    image: ghcr.io/esphome/esphome
    volumes:
      - ./esphome:/config
      - /etc/localtime:/etc/localtime:ro
    restart: unless-stopped
    privileged: true
    network_mode: host
```

## Common Commands

```bash
# Start containers
cd /home/stewartalsop/prototypes/home-assistant
docker compose up -d

# Stop containers
docker compose down

# View logs
docker logs homeassistant -f
docker logs esphome -f

# Restart a specific container
docker compose restart homeassistant
docker compose restart esphome

# Update to latest images
docker compose pull
docker compose up -d
```

## Moving This Installation

If you want to move this to a different location later:

1. Stop containers: `docker compose down`
2. Move the entire `home-assistant/` folder to new location
3. Update the path in any scripts or notes
4. Start containers from new location: `docker compose up -d`

No configuration changes needed - all paths in docker-compose.yml are relative.

## Next Steps (as of 2025-12-11)

1. Complete Home Assistant initial setup (create account)
2. Flash ReSpeaker board with ESPHome firmware using FormatBCE's integration
3. Configure Home Assistant to forward audio to VAPI

## References

- [Seeed ESPHome Wiki](https://wiki.seeedstudio.com/respeaker_xvf3800_xiao_home_assistant/)
- [FormatBCE ESPHome Integration](https://github.com/formatBCE/Respeaker-XVF3800-ESPHome-integration)
- [Home Assistant Community Thread](https://community.home-assistant.io/t/respeaker-xmos-xvf3800-esphome-integration/927241)
